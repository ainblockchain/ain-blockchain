{
  ".write": false,
  "accounts": {
    "$user_addr": {
      "balance": {
        ".write": "auth.fid === '_transfer' || auth.fid === '_deposit' || auth.fid === '_withdraw' || auth.fid === '_pay' || auth.fid === '_claim'"
      }
    }
  },
  "checkin": {
    "$user_addr": {
      "$checkin_id": {
        "request": {
          ".write": "data === null && auth.addr === $user_addr && util.isDict(newData)"
        },
        "parent_finalize": {
          "$tx_hash": {
            "result": {
              ".write": "auth.addr === getValue('/sharding/config/shard_owner') && util.isBool(newData)"
            }
          }
        }
      }
    }
  },
  "consensus": {
    "number": {
      "$number": {
        ".write": "newData === null && !!getValue('/consensus/number/' + (Number($number) + 1000))",
        "propose": {
          ".write": "newData !== null && util.isDict(newData) && newData.proposer === auth.addr && Number($number) === newData.number && getValue('/consensus/whitelist/' + auth.addr) === true && (lastBlockNumber < 1 || getValue('/deposit_accounts/consensus/' + auth.addr + '/value') >= util.getMinStakeAmount())"
        },
        "vote": {
          "$user_addr": {
            ".write": "auth.addr === $user_addr && util.isDict(newData) && util.isString(newData.block_hash) && util.isNumber(newData.stake) && newData.stake > 0 && getValue('/consensus/whitelist/' + auth.addr) === true && (lastBlockNumber < 1 || getValue('/deposit_accounts/consensus/' + auth.addr + '/value') >= util.getMinStakeAmount())"
          }
        }
      }
    },
    "whitelist": {
      "$user_addr": {
        ".write": "auth.addr === util.getOwnerAddr() && (newData === true || (newData === null && util.length(util.values(getValue('/consensus/whitelist')).filter(x => x === true)) > util.getMinNumValidators()))"
      }
    }
  },
  "deposit": {
    "$service": {
      "$user_addr": {
        "$deposit_id": {
          "value": {
            ".write": "auth.addr === $user_addr && !getValue('/deposit/' + $service + '/' + $user_addr + '/' + $deposit_id) && (util.length($user_addr) !== 42 || util.isCksumAddr($user_addr)) && util.isNumber(newData) && getValue('/accounts/' + $user_addr + '/balance') >= newData"
          },
          "created_at": {
            ".write": "auth.fid === '_deposit'"
          },
          "result": {
            ".write": "auth.fid === '_deposit'"
          }
        }
      }
    }
  },
  "deposit_accounts": {
    "$service": {
      "config": {
        ".write": "!getValue('/deposit_accounts/' + $service) || (getOwner('/deposit_accounts/' + $service) && getOwner('/deposit_accounts/' + $service).owners && getOwner('/deposit_accounts/' + $service).owners[auth.addr])"
      },
      "$user_addr": {
        ".write": "auth.fid === '_deposit' || auth.fid === '_withdraw'"
      }
    },
    "consensus": {
      "config": {
        ".write": false
      },
      "$user_addr": {
        ".write": "auth.fid === '_deposit' || auth.fid === '_withdraw'"
      }
    }
  },
  "payments": {
    "$service": {
      "config": {
        "admin": {
          "$admin_addr": {
            ".write": "evalOwner('/payments/' + $service + '/config', 'write_owner', auth) && (newData === true || newData === null)"
          }
        }
      },
      "$user_addr": {
        "claims": {
          "$record_id": {
            ".write": "util.isCksumAddr(auth.addr) && getValue('/payments/' + $service + '/config/admin/' + auth.addr) === true && data === null && newData !== null && util.isNumber(newData.amount) && newData.amount > 0",
            "result": {
              ".write": "auth.fid === '_claim'"
            }
          }
        },
        "pays": {
          "$record_id": {
            ".write": "util.isCksumAddr(auth.addr) && getValue('/payments/' + $service + '/config/admin/' + auth.addr) === true && data === null && newData !== null && util.isNumber(newData.amount) && newData.amount > 0",
            "result": {
              ".write": "auth.fid === '_pay'"
            }
          }
        }
      }
    }
  },
  "service_accounts": {
    "$service_type": {
      "$service_name": {
        "$key": {
          "admin": {
            "$admin_addr": {
              ".write": "auth.fid === '_transfer' || auth.fid === '_deposit' || auth.fid === '_withdraw' || auth.fid === '_pay' || auth.fid === '_claim'"
            }
          },
          "balance": {
            ".write": "auth.fid === '_transfer' || auth.fid === '_deposit' || auth.fid === '_withdraw' || auth.fid === '_pay' || auth.fid === '_claim'"
          }
        }
      }
    }
  },
  "sharding": {
    "shard": {
      ".write": false,
      "$sharding_path": {
        ".write": "(data === null && util.isDict(newData) && util.isString(newData.sharding_path) && util.isString(newData.parent_chain_poc) && util.isNumber(newData.reporting_period) && util.isValAddr(newData.shard_owner) && util.isValAddr(newData.shard_reporter) && util.isValShardProto(newData.sharding_protocol) && evalOwner(newData.sharding_path, 'write_owner', auth) && evalOwner(newData.sharding_path, 'write_rule', auth) && evalOwner(newData.sharding_path, 'write_function', auth)) || (auth.addr === data.shard_owner && newData === null)"
      }
    }
  },
  "transfer": {
    "$from": {
      "$to": {
        "$key": {
          "value": {
            ".write": "(auth.addr === $from || auth.fid === '_deposit' || auth.fid === '_withdraw' || auth.fid === '_pay' || auth.fid === '_claim') && !getValue('transfer/' + $from + '/' + $to + '/' + $key) && (util.isServAcntName($from) || util.isCksumAddr($from)) && (util.isServAcntName($to) || util.isCksumAddr($to)) && $from !== $to && util.isNumber(newData) && getValue(util.getBalancePath($from)) >= newData"
          },
          "result": {
            ".write": "auth.fid === '_transfer'"
          }
        }
      }
    }
  },
  "withdraw":{
    "$service": {
      "$user_addr": {
        "$withdraw_id": {
          "value": {
            ".write": "auth.addr === $user_addr && !getValue('/withdraw/' + $service + '/' + $user_addr + '/' + $withdraw_id) && util.isNumber(newData) && getValue('/deposit_accounts/' + $service + '/' + $user_addr + '/value') >= newData"
          },
          "created_at": {
            ".write": "auth.fid === '_withdraw'"
          },
          "result": {
            ".write": "auth.fid === '_withdraw'"
          }
        }
      }
    }
  }
}
